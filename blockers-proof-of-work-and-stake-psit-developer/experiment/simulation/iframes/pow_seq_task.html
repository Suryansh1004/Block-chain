<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
    <link rel="stylesheet" type="text/css" href="../css/style_task.css">
</head>

<body>
    <h3 style="font-family: sans-serif;">Construct correct sequence of events for Proof of Work Algorithm</h3>
    You are given a series of events, construct the correct sequence of events that takes place in Proof of Work
    Algorithm
    <br />
    Click on the code blocks in the yellow area to add them to grey area(final solution area). Click on validate button
    on the bottom when you think that you're done.
    <br /> <br />
    <div class="wrapper">
        <div class="words" id="targz">
            <div data-ind="0" class="wrd">After validation of hash, miners adds the block to their blockchain(ledger)
            </div>
            <div data-ind="1" class="wrd">One of the nodes(miner) is chosen for validation, known as validator node,
                based on staked amount by each node.</div>
            <div data-ind="2" class="wrd">One of the miner has found the correct hash.</div>
            <div data-ind="3" class="wrd">The validator node is given a reward.</div>
            <div data-ind="4" class="wrd"><b>Block is ready to be published</b></div>
            <div data-ind="5" class="wrd">Other Miners validates the hash that was generated by one of the miner.</div>
            <div data-ind="6" class="wrd">Other nodes adds the block validated by validator node in their blockchain
            </div>
            <div data-ind="7" class="wrd">Miner who found the correct hash, tells it to the other miners.</div>
            <div data-ind="8" class="wrd">Miners starts finding correct hash for the new block(mining).</div>
            <div data-ind="9" class="wrd">Miner who found the correct hash, is given mining reward.</div>
            <div data-ind="10" class="wrd">The chosen node validates the block and tells it to other nodes.</div>
        </div>
        <br /><br />
        <div class="fib" id="psuedo">
            Click on an code block to add it here.
        </div>
    </div>
    <br />
    <button class="butt" onclick="validate()">Validate</button>
    <button class="butt" onclick="hint()">Hint</button>
    <div id="toastArea"></div>
    <script>
        var psArea = document.getElementById("psuedo"), codeQ = document.getElementsByClassName("wrd");
        function hasClass(el, className) {
            if (el.classList)
                return el.classList.contains(className);
            return !!el.className.match(new RegExp('(\\s|^)' + className + '(\\s|$)'));
        }
        function addClass(el, className) {
            if (el.classList)
                el.classList.add(className)
            else if (!hasClass(el, className))
                el.className += " " + className;
        }
        function removeClass(el, className) {
            if (el.classList)
                el.classList.remove(className)
            else if (hasClass(el, className)) {
                var reg = new RegExp('(\\s|^)' + className + '(\\s|$)');
                el.className = el.className.replace(reg, ' ');
            }
        }
        let tos = 0, tarea = document.getElementById("toastArea");

        function malert(msg, type = 0) {
            let tc = type == 0 ? "" : (type == 1 ? " success" : " danger");
            tarea.insertAdjacentHTML("afterbegin", `<div class="toast${tc}" id="t${tos}">
    <div class="toast-head">
        <b>#${tos + 1}</b>&nbsp;Notification
        <button class="toast-but" data-ind="${tos}">&#10006;</button>
    </div>
    <div class="toast-body">
        ${msg}
    </div>
    </div>`);
            addClass(document.getElementById("t" + tos), "show");
            tos++;
        }
        document.addEventListener("DOMContentLoaded", function (event) {
            tarea.style.top = (window.scrollY + document.querySelector('#targz').getBoundingClientRect().top) + "px"
        });

        let ans = [];
        let correct = [4, 8, 2, 7, 5, 0, 9];
        document.body.onclick = function (e) {
            if (window.event) {
                e = event.srcElement;
            }
            else {
                e = e.target;
            }
            if (!e.className)
                return;
            if (e.className.indexOf('wrd') != -1) {
                addClass(e, 'disabled');
                ans.push(parseInt(e.getAttribute('data-ind')));
                // console.log(ans);
                renderPsArea();
            }
            else if (e.className.indexOf('toast-but') != -1) {
                removeClass(document.getElementById("t" + e.getAttribute('data-ind')), 'show');
            }
            else if (e.className.indexOf('delBut') != -1) {
                let i = parseInt(e.getAttribute('data-ind'));
                removeClass(codeQ[ans[i]], "disabled");
                ans.splice(i, 1);
                renderPsArea();

            }
            else if (e.className.indexOf('upBut') != -1) {
                let i = parseInt(e.getAttribute('data-ind'));
                if (i == 0) return;
                var temp;
                temp = ans[i];
                ans[i] = ans[i - 1];
                ans[i - 1] = temp;
                renderPsArea();
            }
            else if (e.className.indexOf('downBut') != -1) {
                let i = parseInt(e.getAttribute('data-ind'));
                if (i == ans.length - 1) return;
                var temp;
                temp = ans[i];
                ans[i] = ans[i + 1];
                ans[i + 1] = temp;
                renderPsArea();
            }
        }
        function validate() {
            if (ans.length === correct.length && ans.every(function (value, index) { return value === correct[index] }))
                malert("Correct!", 1);
            else
                malert("Wrong, click on the hint button to get a hint", 2);
        }
        function getPsAreaBlock(index, indexInAns) {
            return `<div class="sentence">
                ${codeQ[index].innerHTML}
                <div class="butArea">                    
                    <button data-ind="${indexInAns}" class="upBut">&#x2191;</button>
                    <button data-ind="${indexInAns}" class="downBut">&#x2193;</button>
                    <button data-ind="${indexInAns}" class="delBut">X</button>
                </div>
                </div>`;
        }
        function renderPsArea() {
            var res = "";
            for (let i = 0; i < ans.length; i++) {
                res += getPsAreaBlock(ans[i], i);
            }
            if (ans.length == 0) res = "Click on an code block to add it here.";
            psArea.innerHTML = res;
        }
        function hint() {
            malert("Some of the events are not part of the final solution.'Block is ready to be published' will be the first event and the miner getting the reward event will be the last one");
        }  
    </script>
</body>

</html>